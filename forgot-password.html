<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Forgot Password</title>

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">

</head>

<body class="bg-gradient-primary">
	<!-- Reset Authentication-->
	<script type="module" src="/js/firebase-init.js"></script>
	<script type="module">
	  import { auth } from "/js/firebase-init.js";
	  import { sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

		  // Sisipkan style dan form reset secara dinamis
		  const style = document.createElement("style");
		  style.textContent = `
			#fp-enhancer { max-width: 420px; margin: 1.25rem auto; padding: 1rem 1.25rem; border:1px solid #e5e7eb; border-radius:12px; background:#fff; box-shadow:0 6px 20px rgba(0,0,0,.06); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
			#fp-enhancer h2 { margin:.25rem 0 .75rem; font-size:1.15rem; }
			#fp-enhancer label { display:block; margin:.65rem 0 .35rem; font-weight:600; }
			#fp-enhancer input { width:100%; padding:.6rem .75rem; border:1px solid #cbd5e1; border-radius:10px; }
			#fp-enhancer button { margin-top:.75rem; padding:.6rem .9rem; border:0; border-radius:10px; background:#2563eb; color:#fff; cursor:pointer; }
			#fp-enhancer button[disabled]{ opacity:.7; cursor:not-allowed; }
			#fp-enhancer .msg { margin-top:.6rem; font-size:.95rem; }
			#fp-enhancer .err { color:#b91c1c; } .ok{ color:#065f46; }
		  `;
		  document.head.appendChild(style);

		const wrap = document.createElement("div");
	  wrap.id = "fp-enhancer";
	  wrap.innerHTML = `
		<h2>Forgot Password</h2>
		<form id="fpForm" novalidate>
		  <label for="fpEmail">Email</label>
		  <input id="fpEmail" type="email" required placeholder="nama@perusahaan.com" />
		  <button id="fpBtn" type="submit">Kirim Link Reset</button>
		  <div id="fpMsg" class="msg" role="status" aria-live="polite"></div>
		</form>
		<p style="margin-top:.5rem;"><a href="/login_main.html">Kembali ke Login</a></p>
	  `;
	  document.body.appendChild(wrap);

	  // Prefill dari ?email=
	  const params = new URLSearchParams(location.search);
	  const emailEl = wrap.querySelector("#fpEmail");
	  if (params.get("email")) emailEl.value = params.get("email");

	  const form = wrap.querySelector("#fpForm");
	  const btn = wrap.querySelector("#fpBtn");
	  const msg = wrap.querySelector("#fpMsg");

	  form.addEventListener("submit", async (e) => {
		e.preventDefault();
		msg.textContent = ""; msg.className = "msg";
		const email = emailEl.value.trim();
		if (!email) { msg.textContent = "Email wajib diisi."; msg.classList.add("err"); emailEl.focus(); return; }

		try {
		  btn.disabled = true;
		  await sendPasswordResetEmail(auth, email);
		  msg.textContent = "Link reset password telah dikirim. Silakan cek email Anda.";
		  msg.classList.add("ok");
		  setTimeout(() => (window.location.href = "/login_main.html"), 2500);
		} catch (err) {
		  console.error(err);
		  let text = "Gagal mengirim email reset.";
		  if (err.code === "auth/user-not-found") text = "Email tidak terdaftar.";
		  if (err.code === "auth/invalid-email") text = "Format email tidak valid.";
		  msg.textContent = text; msg.classList.add("err");
		} finally {
		  btn.disabled = false;
		}
	  });
	</script>


	<!-- Authentication-->
	<script type="module" src="/js/firebase-init.js"></script>

    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

</body>

</html>
